<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="AI Teacher Assistant - Enhancing education with AI"
    />
    <!-- Inline SVG favicon to avoid 404 errors -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ“</text></svg>" />
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <title>AI Teacher Assistant</title>
    
    <!-- Demo mode initialization - runs before React loads -->
    <script>
      // For GitHub Pages SPA routing - parse the path from the query string
      (function(l) {
        if (l.search[1] === '/') {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          window.history.replaceState(null, null,
            l.pathname.slice(0, -1) + decoded + l.hash
          );
        }
      }(window.location));
      
      // Activate demo mode directly from URL parameter if needed
      const urlParams = new URLSearchParams(window.location.search);
      const forceDemoParam = urlParams.get('demo');
      if (forceDemoParam === 'true') {
        localStorage.setItem('demoMode', 'true');
        console.log('Demo mode activated via URL parameter');
      }
      
      // Force demo mode based on path if coming to a protected route
      if (window.location.pathname.includes('dashboard')) {
        localStorage.setItem('demoMode', 'true');
        console.log('Demo mode activated via dashboard path:', window.location.pathname);
        
        // Set appropriate role based on URL
        if (window.location.pathname.includes('faculty')) {
          localStorage.setItem('demoRole', 'faculty');
        } else if (window.location.pathname.includes('student')) {
          localStorage.setItem('demoRole', 'student');
        } else if (window.location.pathname.includes('parent')) {
          localStorage.setItem('demoRole', 'parent');
        } else if (window.location.pathname.includes('admin')) {
          localStorage.setItem('demoRole', 'admin');
        } else {
          localStorage.setItem('demoRole', 'faculty'); // Default fallback
        }
      }
      
      // Simple error handlers that won't break the app
      window.addEventListener('error', function(e) {
        console.log('Global error caught:', e.message);
        
        // Prevent resource errors from breaking the app
        if (e.filename && (
            e.filename.includes('favicon.ico') || 
            e.filename.includes('logo') || 
            e.filename.includes('manifest.json') ||
            e.filename.includes('%PUBLIC_URL%')
        )) {
          console.log('Suppressed non-critical resource error:', e.filename);
          return true; // Prevent default error handling
        }
        
        // Force demo mode on serious errors
        try {
          if (e.error && typeof e.error.toString === 'function') {
            const errorString = e.error.toString();
            if (errorString.includes('Firebase') || 
                errorString.includes('auth') ||
                errorString.includes('failed')) {
              console.log('Serious error detected, forcing demo mode');
              localStorage.setItem('demoMode', 'true');
            }
          }
        } catch (innerError) {
          console.log('Error in error handler:', innerError);
          // Force demo mode as a fallback
          localStorage.setItem('demoMode', 'true');
        }
      }, true);
      
      // Handle unhandled promise rejections
      window.addEventListener('unhandledrejection', function(event) {
        console.log('Unhandled rejection occurred');
        
        // Force demo mode on auth/firebase rejections
        try {
          if (event.reason && typeof event.reason.toString === 'function') {
            const reasonString = event.reason.toString();
            if (reasonString.includes('Firebase') || 
                reasonString.includes('auth') ||
                reasonString.includes('failed')) {
              console.log('Auth-related rejection, forcing demo mode');
              localStorage.setItem('demoMode', 'true');
              
              // Attempt to extract intended role from URL
              if (window.location.pathname.includes('faculty')) {
                localStorage.setItem('demoRole', 'faculty');
              } else if (window.location.pathname.includes('student')) {
                localStorage.setItem('demoRole', 'student');
              } else if (window.location.pathname.includes('parent')) {
                localStorage.setItem('demoRole', 'parent');
              } else if (window.location.pathname.includes('admin')) {
                localStorage.setItem('demoRole', 'admin');
              } else {
                localStorage.setItem('demoRole', 'faculty'); // Default fallback
              }
            }
          }
        } catch (innerError) {
          console.log('Error in rejection handler:', innerError);
          // Force demo mode as a fallback
          localStorage.setItem('demoMode', 'true');
          localStorage.setItem('demoRole', 'faculty');
        }
      });

      // Auto-recovery for white screens - if the root element doesn't render within 3 seconds
      setTimeout(function() {
        if (!document.getElementById('root').children.length) {
          console.log('Detected white screen - attempting recovery');
          localStorage.setItem('demoMode', 'true');
          localStorage.setItem('demoRole', 'faculty');
          window.location.href = '/';
        }
      }, 3000);
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html> 